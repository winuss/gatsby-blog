{"componentChunkName":"component---src-templates-post-tsx","path":"/what-is-kafka","result":{"data":{"post":{"headings":[{"depth":3},{"depth":3},{"depth":4},{"depth":4},{"depth":4}],"frontmatter":{"title":"카프카(Kafka)의 이해","path":"/what-is-kafka","tags":["DataLake","Kafka","ELK"],"excerpt":"대용량 게임로그 수집을 위해 Elastic Stack을 도입하게 되었는데, 중간에 버퍼역할(메시지큐)을 하는 Kafka에 대서 알아보려고 한다.","created":"2019-01-18T00:00:00.000Z","createdPretty":"18 January, 2019","updated":"2019-01-18T00:00:00.000Z","updatedPretty":"18 January, 2019","featuredImage":{"childImageSharp":{"sizes":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAACB0lEQVQozxWS+08aQRSFN3HuvTNrmtbaULQIC7sLCwvL8hDFB1Z5Q5eHRimoIKRQrDFtrWnS/76zyfz6zXfOnFHY2wDsxChkQrxA7jkz85Cp8O6CPl/jxYgPf4jhkxg8Um0CmSOmu2gfkZ7FoMbeBRT4qJFVxF2daWmIOZDY56Wm+LKk+q0E+GDNOwtq3vPWlC6umLVP6RPQs5LaeB9UMJIkw4FQHJIHLGKDdcBPB3g6FN5SXP/k3pJfPkmYWlNx+QhOhYWTTEv5Mh+OpnEvgbE0pEosmua5c37Qoe6DOn7B5pQ6D9iZiZtnqo1lFyzWWTgF6TJ+MmB7VwEJhxOo2UzPMsPl1RFvzfjwkQ/XUP2KzQm27nn/u+guhPcND7t+OudYmjGSUlDPkGZD2AIzJw9v3G2OfovqWPRW1JlTd079lWyuDtaicYv2sXSAmceQifGCIrXczEkzZiugu1SoSUy9epYheXsuMWrPVW+p9lbyISFRBKuEZp5k7B1dYR9CGM3QXhwMF+N5uYRo3KnjP5uzf/5I/bXqrdSbX3IzPGyzmIPZM+n0w0oY3myzQISituwA1r5/t1Ph7ZmYvKrjV/X2rxi98N4KTofMKoF9hO4ZhS1yTiCUUNjmFoRMyp1xOXKqDPkqS5UxV8Xjvvwk5M3x/AaKzY1keSN5iIU6GjmKJMHIwFbwP8/LYl6rZSiWAAAAAElFTkSuQmCC","aspectRatio":2.0408163265306123,"src":"/static/d0e1435f0f76fea2822ee40147f12b39/90823/cover.png","srcSet":"/static/d0e1435f0f76fea2822ee40147f12b39/dc47e/cover.png 200w,\n/static/d0e1435f0f76fea2822ee40147f12b39/9f2d5/cover.png 400w,\n/static/d0e1435f0f76fea2822ee40147f12b39/90823/cover.png 800w,\n/static/d0e1435f0f76fea2822ee40147f12b39/677fc/cover.png 816w","sizes":"(max-width: 800px) 100vw, 800px"}}}},"html":"<p>대용량 게임로그 수집을 위해 Elastic Stack을 도입하게 되었는데, 중간에 버퍼역할(메시지큐)을 하는 Kafka에 대서 알아보려고 한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1200px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/984e8ecef47cbcc837ebdc9974fdd564/3f20e/kafka-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.666666666666668%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABcRAAAXEQHKJvM/AAABT0lEQVQY0wFEAbv+ABISExwWFRQm////AQAAAAD///8AampqDAwMDDMVFhYW////AHugrgLV//8E2v//BP///wFORYEPKRtGMisdSTBnUKAM////ArL//wS4//8EAO7u7dvj5OTf4ObprgAAAADq6elU4uPj3OPj49jt7e3k7e7uhufi4GTpx7re5rmozuvHvdDg483SyNmm1sbVpNjf5c7S79TF0OvNuNHs08LRAOrn5f/d8vz/fM3u/BOr6XrIyst4u7q6/8DAwP/V1NT/1drbr9S6sYX0cUD/5EcK/+lPIf++yXT/jcoW/4vGDv+20G7/+5tp//aEM//1hzz/AO/v7//z9fb/4ert1QAAAADd3t5r5+fn/+fn5/j09PT/5ujopePa1nv3xrP/6a2V+ey0o/zc4MD8x96a/cfdl/3a47/88s26/O/Fp/zvyK38cZDc1MumzL4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img\"\n        title=\"img\"\n        src=\"/static/984e8ecef47cbcc837ebdc9974fdd564/c1b63/kafka-1.png\"\n        srcset=\"/static/984e8ecef47cbcc837ebdc9974fdd564/5a46d/kafka-1.png 300w,\n/static/984e8ecef47cbcc837ebdc9974fdd564/0a47e/kafka-1.png 600w,\n/static/984e8ecef47cbcc837ebdc9974fdd564/c1b63/kafka-1.png 1200w,\n/static/984e8ecef47cbcc837ebdc9974fdd564/3f20e/kafka-1.png 1275w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h3 id=\"메시지큐\" style=\"position:relative;\"><a href=\"#%EB%A9%94%EC%8B%9C%EC%A7%80%ED%81%90\" aria-label=\"메시지큐 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>메시지큐?</h3>\n<p>메시지 지향 미들웨어(Message Oriented Middleware: MOM)은 비동기 메시지를 사용하는 다른 응용프로그램 사이의 데이터 송수신을 의미하는데 MOM을 구현한 시스템을 메시지큐(Message Queue:MQ)라 한다.</p>\n<h3 id=\"카프카란\" style=\"position:relative;\"><a href=\"#%EC%B9%B4%ED%94%84%EC%B9%B4%EB%9E%80\" aria-label=\"카프카란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>카프카란?</h3>\n<p>분산형 스트리밍 플랫폼(A distributed streaming platform)이다. LinkedIn에서 여러 구직 및 채용 정보들을 한곳에서 처리(발행/구독)할 수 있는 플래폼으로 개발이 시작 되었다고 한다.</p>\n<p>(발행/구독: pub-sub은 메시지를 특정 수신자에게 직접적으로 보내주는 시스템이 아니고, 메시지를 받기를 원하는 사람이 해당 토픽(topic)을 구독함으로써 메시지를 읽어 올 수 있다.)</p>\n<h4 id=\"카프카의-특징\" style=\"position:relative;\"><a href=\"#%EC%B9%B4%ED%94%84%EC%B9%B4%EC%9D%98-%ED%8A%B9%EC%A7%95\" aria-label=\"카프카의 특징 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>카프카의 특징</h4>\n<p>대용량 실시간 로그처리에 특화되어 설계된 메시징 시스템으로 TPS가 매우 우수하고,</p>\n<p>메시지를 메모리에 저장하는 기존 메시징 시스템과는 달리 파일에 저장을 하는데 그로 인해 카프카를 재시작해도 메시지 유실 우려가 감소된다.</p>\n<p>기본 메시징 시스템(rabbitMQ, ActiveMQ)에서는 브로커(Broker)가 컨슈머(consumer)에게 메시지를 push해 주는 방식인데, 카프카는 컨슈머(Consumer)가 브로커(Broker)로부터 메시지를 직접 가져가는 PULL 방식으로 동작하기 때문에 컨슈머는 자신의 처리 능력만큼의 메시지만 가져와 최적의 성능을 낼 수 있다. 대용량처리에 특화 되었다는 것은 아마도 이러한 구조로 설계가 되어 가능하게 된게 아닌가 싶다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 963px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/31bca4855eb5e365bdf21007dcdf393f/e4a12/kafka-2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 21%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABcRAAAXEQHKJvM/AAABDElEQVQY0yWQXU+CYBiG+eEdtHXYUf8hR7XVppXVPLCPhRqiOXwTP4akEGAIr0BqR1doB9d279mue7sfJY5CtlnCOo3Z5gnR9wLf98nSFbYzp6F3eNZavDTeitxlYjuEgY+UklTGe2/HpuhYJTGKJmZc6S43hku57WGYFvX6I8PRmP7Q5rp6z2mphKqqVB9qtDomr1oTIQSmHVBpu9x1Pcr6jIEToJw9DTi6NDm5/eDwvEuzP+UrjHC8BYYY0xNDxCTAmoYIa7K/zcMlc8+nqtscXvQ4rggO1A41fYSyjCJkkhDHMSuZFFNT8izjd7PG/nTRDJPmu0WrYJenM5ft+oc8z/Zv2XnLgn9f8gecwRr65NGmXwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img\"\n        title=\"img\"\n        src=\"/static/31bca4855eb5e365bdf21007dcdf393f/e4a12/kafka-2.png\"\n        srcset=\"/static/31bca4855eb5e365bdf21007dcdf393f/5a46d/kafka-2.png 300w,\n/static/31bca4855eb5e365bdf21007dcdf393f/0a47e/kafka-2.png 600w,\n/static/31bca4855eb5e365bdf21007dcdf393f/e4a12/kafka-2.png 963w\"\n        sizes=\"(max-width: 963px) 100vw, 963px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>여기서 한가지 의문이 든다. 일반적으로 파일보다 메모리가 성능이 우수한데 왜 카프카가 성능이 좋은 것일까? 그 이유는 카프카의 파일 시스템을 활용한 고성능 디자인에 있다. 일반적으로 하드디스크는 메모리보다 수백배 느리지만 하드디스크의 순차적 읽기에 대한 성능은 메모리보다 크게 떨어지지 않는다고 한다. </p>\n<p>컨슈머(Consumer)와 브로커(Broker)에 대해서는 카프카 구성요소에 대한 설명에서 좀 더 자세히 알아보자.</p>\n<h4 id=\"카프카의-구성요소\" style=\"position:relative;\"><a href=\"#%EC%B9%B4%ED%94%84%EC%B9%B4%EC%9D%98-%EA%B5%AC%EC%84%B1%EC%9A%94%EC%86%8C\" aria-label=\"카프카의 구성요소 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>카프카의 구성요소</h4>\n<p>카프카에는 다음과 같이 여러 구성요소가 있다.</p>\n<p><strong>topic, partition, offset</strong></p>\n<p><strong>producer, consumer, consumer group</strong></p>\n<p><strong>broker, zookeeper</strong></p>\n<p><strong>replication</strong></p>\n<p>구성요소 하나씩 살펴보도록 하자.</p>\n<p><strong>Topic, Partition</strong> : 카프카에 저장되는 메시지는 topic으로 분류되고, topic은 여러개의 patition으로 나눠질수 있다. partition안에는 message의 상대적 위치를 내타내는 offset이 있는데 이 offet정보를 이용해 이전에 가져간 메시지의 위치 정보를 알 수 있고 동시에 들어오는 많은 데이터를 여러개의 파티션에 나누어 저장하기 때문에 병렬로 빠르게 처리할 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1200px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/91c3610af56095bf597662910190cad0/f2b95/kafka-3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABcRAAAXEQHKJvM/AAABQ0lEQVQoz2WS6XaCMBCFef8XsmLZoXjcEBH7pxjAsInsD3CbxOJpT3985062OzNJpGEY0Pc9uI7jgK4fQGgj+LzeQcsW0zSy9ZGtTyLuiwRdRdneHm3b/kFK0xRZliE8n3EOApx8H4fDk+3uCM/zxfzR83DY77ExFXwFe5RF/lPEyJJMAh5L3IxSCk1VsZJlvC0WUN5XUFYcWai8XMIyTZEsDEOQOEFZVmiaRjBXxxNIURSBEIIPx4FtWjB0XRzmmIbx0rXr4hJekOf5y6iqKhRFIQqK4/jZ8vUasQGBY1vssAFDU2FxI0OHqWsMnSWzsVm7WH84CE4+M7ihrutXdXProkJ+hyROYdkuNN2CohpMbRHP4+3OA0ko7o8ORfVAVbMWu6fJzGwq8dfjL8lJ8gbpP9h81jAeIr4VrfgBlOls9JtvSaD2OqnS9UgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img\"\n        title=\"img\"\n        src=\"/static/91c3610af56095bf597662910190cad0/c1b63/kafka-3.png\"\n        srcset=\"/static/91c3610af56095bf597662910190cad0/5a46d/kafka-3.png 300w,\n/static/91c3610af56095bf597662910190cad0/0a47e/kafka-3.png 600w,\n/static/91c3610af56095bf597662910190cad0/c1b63/kafka-3.png 1200w,\n/static/91c3610af56095bf597662910190cad0/f2b95/kafka-3.png 1515w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><strong>Producer, Consumer</strong> : 말대로 Producer는 생산(메시지를 Write)하는 주체, Consumer는 소비(메시지를 Read)하는 주체이다. Producer와 Consumer간에는 상호 존재 여부를 알지 못한채 자신에게 주어진 역할만 처리 하게 된다. (위 그림에서 보면 Writes가 Producer)</p>\n<p><strong>Consumer Group</strong> : Producer에서 생산(Write)한 메시지는 여러개의 파티션에 저장을 하는데, 그렇다면 소비하는(Consumer)하는 쪽에서도 여러 소비자가 메시지를 읽어가는것이 훨씬 효율적일 것이다. 하나의 목표를 위해 소비를 하는 그룹, 즉 하나의 토픽을 읽어가기 위한 Counsumer들을 Consumer Group라고 한다.</p>\n<p>하지만 이 Consumer Group에는 한가지 룰이 있다. Topic의 파티션은 그 Consumer Group과 1:n 매칭. 즉, 자신이 읽고 있는 파티션에는 같은 그룹내 다른 컨슈머가 읽을 수 없다. (파티션에는 동일한 Consumer Group을 위한 하나의 구멍이 있고, Consumer는 그 구멍에 빨대를 꽂아 읽어간다고 생각하면 쉽게 상상이 될지도….^^;)</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1200px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/77fd5e51454a353a20d2f770df92d6cc/7575b/kafka-4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 30.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABcRAAAXEQHKJvM/AAABbUlEQVQY00WRS2/aUBCF/f83WVTdRN1U6oYqiiK1SXEcPwiPygiKmxaCDX4AJn4/Yf/14lbq4tO5M7o6OjMj5XlO0zRUVdXRNDVhlBOEGbafdHrpVXVD3bQURUF4PFKUJaX4XwqtBdWlFkhpmhKGIbvdjvlsxuLHnOl0hmnOGE9MpvMFlmUxkRXGssxkPMJ3txR5RltXmKsDxssR3doTxhlSFEV4nodj22hPT+iaJlA7VfvfUHo9VFGbzwPc3wv22zXRzqVK3jhlb9wMba4eHK6+LnH3EVIcxwRBwGazYWAYPA8Gf3U4RNd1jLtblE8f0eV7piOjMyyTI22R0ArD29Gad/017x+WeIfof0JbJFT/JdRUlcfeZx77snhrTFSF9fIX7nJB6G8o00gYipHzmC/fHa4Vhw/KK/4hRros+XKMLMvwfZ9A4IvE7ouFt/qJ76wIg22X6lymnM9n2tOJtm1pBElWCHKSNBdHqvkDEYinXOLdlHUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img\"\n        title=\"img\"\n        src=\"/static/77fd5e51454a353a20d2f770df92d6cc/c1b63/kafka-4.png\"\n        srcset=\"/static/77fd5e51454a353a20d2f770df92d6cc/5a46d/kafka-4.png 300w,\n/static/77fd5e51454a353a20d2f770df92d6cc/0a47e/kafka-4.png 600w,\n/static/77fd5e51454a353a20d2f770df92d6cc/c1b63/kafka-4.png 1200w,\n/static/77fd5e51454a353a20d2f770df92d6cc/7575b/kafka-4.png 1608w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>위 그림과 같이 하나의 토픽에 4개의 파티션이 있고 컨슈머그룹내 3개의 컨슈머가 있다면 컨슈머1,2,3은 각 파티션 1,2,3에 순차적으로 배치가 될 것이고, offset정보를 이용해 순차적으로 데이터를 읽게 된다. 문제는 파티션4인데 컨슈머 갯수가 파티션 갯수보다 작다면 컨슈머 1,2,3중 하나가 파티션4에 접근하여 데이터를 읽게 된다. 만약 파티션 갯수와 컨슈머 갯수가 동일하개 4개씩이라면 각 컨슈머들은 하나의 파티션에서 데이터를 읽게 될것 이고, 파티션갯수가 4개고 컨슈머 갯수가 5개이면 컨슈머5는 그냥 아무일도 안하게 된다.(일반적으로 파티션 갯수와 컨슈머 갯수는 동일하게 구성하는 것을 추천한다고 함.)</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1200px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/dd1df7bbbc2edce0b70b8f44c48d662b/f33fc/kafka-5.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 22.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABcRAAAXEQHKJvM/AAABG0lEQVQY0xXPTU/CQBgEYH64Z+Mv8KAXE3vwRGoiqUYUJPIpYCA0FGpbWtruu9stXVLw1OxYzzN5JtPIKEJOHg58D0EEKfOqLE8gIlOyQB1lVGeJFpzrQh0hMqk4pUZOAQoR6pynmhNHUSh4foAGhSvETgdlXZg6DK1pVI23ApxzM/2ZqMwbQgmmP5axtuYJRva+HkmNZDtAHky0YFy/zEK0ZjEG3w4aIrKRbnr4FTuYfRcXD/PqvuvWIJnMq0F/iIISffe21pemjeano84HZiRuDe6mOomZvrZWuHq08dxf/IMrsE0XZx6gM/dx+/RVWeMtiDFT5aROSuAgpX6d+bo58tFb+ErlmaEkQ1lfTsJQG+9r3LRdtIdL/AGhgBmE9BJWawAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img\"\n        title=\"img\"\n        src=\"/static/dd1df7bbbc2edce0b70b8f44c48d662b/c1b63/kafka-5.png\"\n        srcset=\"/static/dd1df7bbbc2edce0b70b8f44c48d662b/5a46d/kafka-5.png 300w,\n/static/dd1df7bbbc2edce0b70b8f44c48d662b/0a47e/kafka-5.png 600w,\n/static/dd1df7bbbc2edce0b70b8f44c48d662b/c1b63/kafka-5.png 1200w,\n/static/dd1df7bbbc2edce0b70b8f44c48d662b/d61c2/kafka-5.png 1800w,\n/static/dd1df7bbbc2edce0b70b8f44c48d662b/f33fc/kafka-5.png 1905w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>컨슈머그룹이 존재하는 또 다른 이유가 있다. 물론 이러한 구조로 데이터를 병렬로 읽게 되어 빠른처리가 가능하다는 부분도 있겠지만, 특정 컨슈머에 문제가 생겼을 경우 다른 그룹내 컨슈머가 대신 읽을 수 있게 리벨런싱이 되어 장애 상황에서도 문제 없이 대처할 수 있게 된다.</p>\n<p><strong>Broker, Zookeeper</strong> : broker는 카프카 서버를 칭한다. 동일한 노드내에서 여러개의 broker서버를 띄울 수 있고, Zookeeper는 이러한 분산 메시지큐의 정보를 관리해주는 역할을 한다. 카프카를 띄우기 위해서는 반드시 주키퍼가 실행되어야 한다.</p>\n<p><strong>Replication</strong> : 카프카에서는 replication 수를 임의로 지정하여 topic를 만들 수 있다. replication-factor에 지정하는데 만약 3으로 하면 replication 수가 3이 된다.</p>\n<p>Kafka Cluster에 3개의 broker가 있고 3개의 Topic이 있다고 가정해보자.</p>\n<p>Topic-1은 replication-factor 1, Topic-2은 replication-factor 2, Topic-3은 replication-factor 3인 경우이다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 999px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d7876e7b37b5b7fbfc188e07f96f82d5/20c85/kafka-6.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABcRAAAXEQHKJvM/AAACF0lEQVQoz0WSW2sTQQCF8ytF/AEiaBVERClVFItFKdbbk9VWrVaLSpFCLQELKZtGoUhNss1lk83uziZ7vyWt7dPnZKvtw+HMnJk5nDMzBT8ICONYIsQPQzw598OIbDhE2H2qtRptrcNutUajpZGkKXGSEMkzUZwQRnG+P82GWJZFQTdtmnpEoxPjuvsk0RH2IKFnO7QNh6rm0hU+bhBjDXyE46MLhx3VQu0MMGxP6h76mE2TQlcabvz6ykrlFas7L1j5OcdWtYghAgaehCuTRAn7wyxPZTvHpsKJZLKULMsYSthuiDk27Bg2nyqLzG9O83hjium1y3xRljHtCCcIGcrqcZoRZyP8KD0xjKX5KEtJZf1EjoUTnBp6a09J310jWbzC8Nk5eusv6fgHCGWV6O0E/psJwudn0BeuyopOniYcHZAdHpH+Ocxhe9GxYdfsY6wvIT7MYr6fwZy/Sav4ma4/wvjxHbH8EFOuiYVbtD4+wey78rEcgvpvskaNtFElru/K+7MxLUFBMwT20jz+3D2cmUnc6+dpLb9GC0dYxW/4j+7izN7Bm7yI9uA2hnyYXrOFff8G/uwU7uQFzEtnaSgKlutRGFfoyu+g11W66l7OWruTV+jp5qmuqrTVBn1X3pXt0q5LrdFE32uijcfmACFkwlKpxFZ5m63tiuTKMStlymUl59J/LV/fRpFJxjjR/qEsUSwW+QuT0nNPJOICnAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img\"\n        title=\"img\"\n        src=\"/static/d7876e7b37b5b7fbfc188e07f96f82d5/20c85/kafka-6.png\"\n        srcset=\"/static/d7876e7b37b5b7fbfc188e07f96f82d5/5a46d/kafka-6.png 300w,\n/static/d7876e7b37b5b7fbfc188e07f96f82d5/0a47e/kafka-6.png 600w,\n/static/d7876e7b37b5b7fbfc188e07f96f82d5/20c85/kafka-6.png 999w\"\n        sizes=\"(max-width: 999px) 100vw, 999px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>그렇다면 replication은 왜 필요할까? 단지 데이터의 복제 용도라기 보다는 특정 borker에 문제가 생겼을 경우 해당 broker의 역할을 다른 broker에서 즉각적으로 대신 수행 할 수 있게 하기 위한 용도 일 것이다.</p>\n<h4 id=\"replication---leader--follower\" style=\"position:relative;\"><a href=\"#replication---leader--follower\" aria-label=\"replication   leader  follower permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Replication - leader &#x26; follower</h4>\n<p>replication을 좀더 자세히 들여다보면, 복제요소중 대표인 leader, 그외 요소인 follower로 나누어진다. topic으로 통하는 모든 데이터의 read/write는 오직 leader에서 이루어지고 follower는 leader와 sync를 유지함으로써 leader에 문제가 생겼을 경우 follower들 중 하나가 leader역할을 하게 되는 것이다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 999px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2fe199901b5463354d8122ca24b79a3b/20c85/kafka-7.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABcRAAAXEQHKJvM/AAACFklEQVQoz02STU8TURSG+3tduDBuWOCGjYiJJu4MGhQSiEaMNSpIBUJpO2CQBlr6NZ22M3em8/3Vorh6PBRiWJyc3Pee897n3HsLYRgRpwlxEhNEEWEUE8UJk8kEZTs0mk16/T5njSadnk6W5aRpRpKms4jiVPoS8skUpRSFgeXQHcR0jBTPv8SLM0ZuwMj26I08znWfgQrwpclyQ2zZGyiPk5aiZbhS52ONpeY6W5YYmg7b9SLvtFcUT15z8auM1TLoKxfXjxh7Qi8Ul9PJjMj2gpmpcmOZJiPPc6aTHFtqTVMMDdPmg7bCy70FlncWOf78nsrBLkMnxAvj2ejJ9ZizKxHDW8pE1tM8I5NDUgnlRTeEfSH0v7wgW3tAvPqQs9I+P8tthm6Gqn4S7T7Bm3uo4gr6t+9CoXCEJpr+Jr/6S/7ninw6vUvoMNpaQ208xdx4RuNriXrlFMNJMY/3Zrq1voSx+Zb6zi4j08ceu4TNM/J2g7R1TmjZons3hPpIYa8tEzxfwH3yiJP1LWo/LjDGCWZpe6YHS/Ocr35kv3iKqSKGnS724znCpTmsxXmaK+u0j+qo8ZiCabsYXZ1BU0xabXRDocv3sP2Y4cC80SX6ondbHXmkAMvx6TVbDKTe6Oj0LuSK5C1s+WaFcvmAw5pGuXYkoXFYqXJYrVGtVCRXb/Wj/3pFckX2ynd6ylWNqqZRKpX4B3xkeV6QnCNQAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img\"\n        title=\"img\"\n        src=\"/static/2fe199901b5463354d8122ca24b79a3b/20c85/kafka-7.png\"\n        srcset=\"/static/2fe199901b5463354d8122ca24b79a3b/5a46d/kafka-7.png 300w,\n/static/2fe199901b5463354d8122ca24b79a3b/0a47e/kafka-7.png 600w,\n/static/2fe199901b5463354d8122ca24b79a3b/20c85/kafka-7.png 999w\"\n        sizes=\"(max-width: 999px) 100vw, 999px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>만약 카프카 클러스터내 broker 2에서 장애가 발생되었다면, broker 2에 있던 Topic-2(leader)의 역할을 대신 수행하기 위해 아래 그림과 같이 broker 1에 있는 Topic(follower)가 leader역할을 하게 될 것이다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 999px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c060993079c074e7df26548f915d0ff3/20c85/kafka-8.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABcRAAAXEQHKJvM/AAACKklEQVQoz02RSU9TYRSG+2vc+NtcsHBBIm5wgUAiiTtFg6YMMWICxODQWqXTBZVQob0tLff2zkPv1K8XhNXjV9yweHK+fDnDe95TiKKYJEtJ0oRRHBPFCXGSMplM8F0XVVUZDvp0agdolTLCtUnFhDRNSbNM5mayLkVMcmzbpqBbLud6Qk/LCMJLgmSM7o3wvYCroc51q0XuuYhHD7m5f4/s7UsGseC4baJqHoYTYnkh+jRalmxounw+2eWd8ord369Rj6sYHR3PD7k0hoh2m4lpkvkeSeuYiWViBTGOP91mjBCCfCJwwhjTlA0102FbWeNFZZ7Vrwsc7r2nVqsw6g3I5bqp45EZFqKrMk7H5KMIyx+RSYtyMWYs184kthxyq/BCKgw/PmdcnCFZn8Uo7aOVy8TtHrGyQ7QxQ1x8wGDvDaeVHwjTwAoTkvwKcX2D+HuNyPO7Cl2MT0XsrWXMrWdc7H7gpHqEH4yJfpYxN5exNxbp76zT+l4htHxsN5AD/0jVZ2TqKZHlYJjBf4UDw8YprjJamcdfnOPX5hdq37oEU4/K+/grTwiXHnO6tU21dERoywP0znEWZomWZrGeztFe26R7eILteRRMx0c7H6C3O2hqlwvNot8fEIURYqgRqWfEklA3iaSPV6HP0A3pt1V0ma9Jr/udLkN5C8dxKVSrB9SaCtXmoUShVm9QazSp1+s0JE35vqVek7Fx+z+leqem2lBoKAqlUol/naB12hAcpLoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img\"\n        title=\"img\"\n        src=\"/static/c060993079c074e7df26548f915d0ff3/20c85/kafka-8.png\"\n        srcset=\"/static/c060993079c074e7df26548f915d0ff3/5a46d/kafka-8.png 300w,\n/static/c060993079c074e7df26548f915d0ff3/0a47e/kafka-8.png 600w,\n/static/c060993079c074e7df26548f915d0ff3/20c85/kafka-8.png 999w\"\n        sizes=\"(max-width: 999px) 100vw, 999px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>복제된 데이터가 follower들에게 있으니, 메시지의 유실이 없다는 장점이 있지만, 복제를 하기 위한 시간과 네트워크 비용이 들기 때문에 데이터의 중요도에 따라 ack옵션으로 성능과 데이터의 중요도에 따라 다음과 같이 세부설정이 가능하다.</p>\n<p><strong>ack (default:1)</strong></p>\n<blockquote>\n<ul>\n<li>0 : 프로듀서는 서버로부터 어떠한 ack도 기다리지 않음. 유실율 높으나 높은 처리량</li>\n<li>1 : 리더는 데이터를 기록, 모든 팔로워는 확인하지 않음</li>\n<li>-1(또는 all) : 모든 ISR 확인. 무손실</li>\n</ul>\n</blockquote>\n<p>ack값을 설정하여 데이터의 무손실에 더 중요성을 둘 것인지 또는 유실을 어느정도 감수 하더라고 속도에 중요성을 둘 것인지를 셋팅할 수 있다.</p>\n<p>지금까지 설명한 모든 구성요소를 그림으로 표현하면 아래 그림과 같다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1200px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/37c693fab41878c91d8ebad4c63e26b9/fbf76/kafka-9.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 69%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABcRAAAXEQHKJvM/AAAC80lEQVQ4y1WTy4/SUBjF+R818V9wo8aViRsXGmOiieLExGeiC92OiuAAOgrykBkeUwqlHYEWSp/Q90PUxfFrwZlxcXJveu/3u+frPTejv7wC6+UlrBK9ugzz4QWYD86RzkO/fw46jcZW+vbbZv1UxnbUaD1jr5bwPRee68J3HXiOBc9eIfIdsOwAe3tFFItFlEollMslNL+3kNQErgXfOVXg2nBWJgEdB2EYIgiCjWjuej6iOEaHGeBDvoB8/iNpD7lcHpVaEyvbPdlnuxs5NLdsBxnNMDHXlpC3UnRy7BOQCnr9IQ7YEZjxBJIqQdZl1FudtND3Pai01zBWqUzTwkI1kBnPVDwtC3ixP8bdHI/3TQGuZZJbH+xwjN3Gazyr3MTOp2t4U3+A2vc2FE1DHAbo/VDx/POUakU8Lk/QGojITOYqdgocdj7yuL07xLsGjz7DYMAJaDMchONjzOUZxtMJxJmUOmwedsELAlqcjCdlPjWUzQ9RZ8YJUMOTEk8LAu7lRsiRQ8f1sLR9tLosaq0jHBzxYLnj9JBK4wCKYcFyXDQGsxSUzXO4+44l4I9NyzuFER4VBdza5bBb4/Ez9BBHEbr0Dw97Qwx4kRyKmJDq1PLKsrGOQ3I4x/38CNkCjztvB6j2CKhoBiRZxWyhQpwrkBZ6emvJpSTADrU9OpYwESVMxaTlNpYEDCkRw6mKal8izfCVkTAczyk2tp3GxfeD7ejT7RkIo5jcsdivHhCEQfeIRbfXx/63ZurQcrw0Nr/IaaLf64iy7GyACcTzvHR0KJfNRoNalNIYiJoOgeI0UkxMNIoYdWK7AR3AgOM4MhHSP6eHkWSSWBnLsk6A/6SqKpTFApYXIh6x8GtfEDS+Yt1p0Cux0xCbhoHlcvmfmRToEj15KWcV0yuJoxD+7z+wnmfhXr8I7+ZVGDeuwJ7PEa3XiOjSEv2rSeYJKyPLMjQKauLqrBRFgU4uuD6Dw2oF3XoNbZJMwHQ/rZ/dn3xLWH8BD3Dbjy61/54AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img\"\n        title=\"img\"\n        src=\"/static/37c693fab41878c91d8ebad4c63e26b9/c1b63/kafka-9.png\"\n        srcset=\"/static/37c693fab41878c91d8ebad4c63e26b9/5a46d/kafka-9.png 300w,\n/static/37c693fab41878c91d8ebad4c63e26b9/0a47e/kafka-9.png 600w,\n/static/37c693fab41878c91d8ebad4c63e26b9/c1b63/kafka-9.png 1200w,\n/static/37c693fab41878c91d8ebad4c63e26b9/fbf76/kafka-9.png 1252w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Producer에서는 메시지를 입력하고, Consumer에서 메시지를 읽어갈때 Zookeeper에서 broker 및 offset정보를 관리하기 때문에 분산처리가 가능하게 된다.</p>\n<p>카프카를 운영하기에 앞서 기본적인 구성요소나 매커니즘에 대해 충분히 이해를 하면 운영 하는데 많은 도움이 될 것이다.</p>\n<p><strong>참고자료</strong></p>\n<ul>\n<li>공식홈 문서 : <a href=\"http://kafka.apache.org/documentation/\">http://kafka.apache.org/documentation/</a></li>\n</ul>"},"primaryTag":{"name":"DataLake","color":"#b798f5"}},"pageContext":{"postId":"78fb87d5-8ab5-5572-a79f-aee860e7077b","primaryTag":"DataLake"}}}