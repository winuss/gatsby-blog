{"componentChunkName":"component---src-templates-post-tsx","path":"/nb-tf-text-classification","result":{"data":{"post":{"headings":[{"depth":2},{"depth":3},{"depth":2},{"depth":2},{"depth":2},{"depth":2},{"depth":2}],"frontmatter":{"title":"TF - 텍스트 분류","path":"/nb-tf-text-classification","tags":["ML-DL","Tensorflow","자연어처리"],"excerpt":"TF-IDF 및 Word2Vec을 이용해 텍스트를 분류해 보았다. 이번에는 텐서플로를 이용하여 텍스트를 분류 해보자.","created":"2019-08-07T00:00:00.000Z","createdPretty":"07 August, 2019","updated":"2019-08-07T00:00:00.000Z","updatedPretty":"07 August, 2019","featuredImage":{"childImageSharp":{"sizes":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAACq0lEQVQozx2S61MaVxiH9z9vM37oTGaMzYdOZjoxkDSYSsUoF2VBYGHZBZa9s1xXECEh1tHGOiYmveTJKx/Pztnn/G5KYGmcxz5XqzG3V2fc/XXO55sF938v6XQaLBYzJgObL3J++P7ldkXoe6RSKbRygdOBR+C0MfUqR7l9lDiy+LAYrIHXq5FAZ/xzt+LDcoTVNej3HQyjyuo84v/PF3z6uECrlijkczRrRaYDl54ALbPOSamAYnd15rOAy3cj4qHD2cTh2/0K1zGI45C6VqTTrnMa9xhEXeKRRz53wMHbfcy6ugZGbgu7rVOrFFF0/YTpxBPgGLNZYdxvwdcVy3mE4+iUS1kulkN0sZRIPKfdbvL6tyTFozwdvcREHNotDb2mCvAYpVkvMRu5a2AUWMxjj38/LcXalEuJYRgavJv3eb+MOT8bEoia9O4Ox4WsAFX5p4XrdthL/85RPoPSbT2UEojVgF7YwevWubua8p9A765j7m/OJAqPt/tvqJZzDAODzN6uAHawmiqBZ7Gb3iWzn+HNzksUQ6+IqoB+z8GSrJyHTKchi1nI5TKS1meMh67kPEDXVEJbw7ZMsXyIqeXxbYPNzU0SyRckk9soloRpNjVR4TKU0Pu9rrzaQpMyRpHJxz/HnIiybDYjs0gzn9jMRMCJmkOv5Ih8U9Rn+OHRjwJNoJRLx/iOKVsyCb02Q9mV3dG4kEydbkOgXXnIYixbbAhgcequ72cP0jKbAr5EVFLzPNrYYDvxQiw3qwLQJWxTVJVlczXigSXAEYZZJfBb5LNpIq8hWTssp74oPuLZs19E5QGWUVm3+2Rri58eP5ZSxLJrm/T8No6l03hofSytvx9LVjVCV6daKaAWD8n8kcI2y3i2zs9Pt3iV/JWmdkxZPSS185rtZJLvwzHg37et5ogAAAAASUVORK5CYII=","aspectRatio":1.7543859649122806,"src":"/static/75607baa2f5b42d177f8624f11ec54bf/f93e4/cover.png","srcSet":"/static/75607baa2f5b42d177f8624f11ec54bf/dc47e/cover.png 200w,\n/static/75607baa2f5b42d177f8624f11ec54bf/9f2d5/cover.png 400w,\n/static/75607baa2f5b42d177f8624f11ec54bf/f93e4/cover.png 490w","sizes":"(max-width: 490px) 100vw, 490px"}}}},"html":"<p>지난번에 TF-IDF 및 Word2Vec을 이용해 텍스트를 분류해 보았다. 이번에는 텐서플로를 이용하여 텍스트를 분류 해보자.</p>\n<p>여기에서는 인터넷 영화 데이터베이스(Internet Movie Database)에서 수집한 50,000개의 영화 리뷰 텍스트를 담은 IMDB 데이터셋을 사용하겠다. 25,000개 리뷰는 훈련용으로, 25,000개는 테스트용으로 나뉘어져 있고, 훈련 세트와 테스트 세트의 클래스는 균형이 잡혀 있다. 즉 긍정적인 리뷰와 부정적인 리뷰의 개수가 동일하다.</p>\n<p>데이터는 Keras에서 제공하는 datasets를 이용하여 다운로드 하자.</p>\n<h2 id=\"text-classification\" style=\"position:relative;\"><a href=\"#text-classification\" aria-label=\"text classification permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Text Classification</h2>\n<p><a href=\"https://www.tensorflow.org/tutorials/keras/basic_text_classification?hl=ko\">https://www.tensorflow.org/tutorials/keras/basic_text_classification?hl=ko</a></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> __future__ <span class=\"token keyword\">import</span> absolute_import<span class=\"token punctuation\">,</span> division<span class=\"token punctuation\">,</span> print_function<span class=\"token punctuation\">,</span> unicode_literals<span class=\"token punctuation\">,</span> unicode_literals\n<span class=\"token keyword\">import</span> tensorflow <span class=\"token keyword\">as</span> tf\n<span class=\"token keyword\">from</span> tensorflow <span class=\"token keyword\">import</span> keras</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> numpy <span class=\"token keyword\">as</span> np\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>tf<span class=\"token punctuation\">.</span>__version__<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>np<span class=\"token punctuation\">.</span>__version__<span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">1.13.1\n1.16.2</code></pre></div>\n<p>만약 numpy 버전이 1.16.2 이상의 버전이라면 삭제 후 버전을 지정하여 설치를 해야 한다. </p>\n<p>(imdb.load_data를 하는 도중 오류 발생)</p>\n<blockquote>\n<p>conda install numpy=1.16.2</p>\n</blockquote>\n<h3 id=\"데이터-준비\" style=\"position:relative;\"><a href=\"#%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%A4%80%EB%B9%84\" aria-label=\"데이터 준비 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>데이터 준비</h3>\n<ul>\n<li>keras dataset에 있는 imdb를 사용한다.</li>\n<li>train과 test 데이터 셋은 각각 25,000개 이며 데이터는 review 자체로 구성</li>\n<li>labels는 0또는 1값으로 긍정 부정을 나타냄</li>\n</ul>\n<blockquote>\n<p>test데이터를 이용하여 해당 Review가 영화에 대해 긍정 또는 부정적인지를 예측해 본다.</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">imdb <span class=\"token operator\">=</span> keras<span class=\"token punctuation\">.</span>datasets<span class=\"token punctuation\">.</span>imdb\n\n<span class=\"token punctuation\">(</span>train_data<span class=\"token punctuation\">,</span> train_labels<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>test_data<span class=\"token punctuation\">,</span> test_labels<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> imdb<span class=\"token punctuation\">.</span>load_data<span class=\"token punctuation\">(</span>num_words<span class=\"token operator\">=</span><span class=\"token number\">10000</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"훈련 샘플: {}, 레이블: {}\"</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>train_data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>train_labels<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">훈련 샘플: 25000, 레이블: 25000</code></pre></div>\n<p>실제 데이터를 살펴보면 문자가 아닌 숫자 값이 리스트로 들어있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>train_data<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[1, 14, 22, 16, 43, 530, 973, 1622, 1385, 65, 458, 4468, 66, 3941, 4, 173, 36, 256, 5, 25, 100, 43, 838, 112, 50, 670, 2, 9, 35, 480, 284, 5, 150, 4, 172, 112, 167, 2, 336, 385, 39, 4, 172, 4536, 1111, 17, 546, 38, 13, 447, 4, 192, 50, 16, 6, 147, 2025, 19, 14, 22, 4, 1920, 4613, 469, 4, 22, 71, 87, 12, 16, 43, 530, 38, 76, 15, 13, 1247, 4, 22, 17, 515, 17, 12, 16, 626, 18, 2, 5, 62, 386, 12, 8, 316, 8, 106, 5, 4, 2223, 5244, 16, 480, 66, 3785, 33, 4, 130, 12, 16, 38, 619, 5, 25, 124, 51, 36, 135, 48, 25, 1415, 33, 6, 22, 12, 215, 28, 77, 52, 5, 14, 407, 16, 82, 2, 8, 4, 107, 117, 5952, 15, 256, 4, 2, 7, 3766, 5, 723, 36, 71, 43, 530, 476, 26, 400, 317, 46, 7, 4, 2, 1029, 13, 104, 88, 4, 381, 15, 297, 98, 32, 2071, 56, 26, 141, 6, 194, 7486, 18, 4, 226, 22, 21, 134, 476, 26, 480, 5, 144, 30, 5535, 18, 51, 36, 28, 224, 92, 25, 104, 4, 226, 65, 16, 38, 1334, 88, 12, 16, 283, 5, 16, 4472, 113, 103, 32, 15, 16, 5345, 19, 178, 32]</code></pre></div>\n<p>이렇게 되어 있는 이유는 추가적인 dictionary에 각 숫자와 단어가 매칭되어 있기 때문이다. 또한 아래와 같이 각각의 데이터 길이도 다른것을 확인 할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>train_data<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>train_data<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">(218, 189)</code></pre></div>\n<p>하지만 실제로 ML모델에 넣어줄때는 입력 길이는 모두 같아야 한다. 따라서 입력길이를 모두 동일하게 해주는 작업이 필요하다. 먼저 데이터를 보다 자세히 확인해보기 위해 각 데이터의 숫자를 단어로 치환해 보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># 숫자로 된 값을 단어로 바꾸기 위한 dictionary를 가져온다.</span>\nword_index <span class=\"token operator\">=</span> imdb<span class=\"token punctuation\">.</span>get_word_index<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>\n<p>word_index</p>\n<blockquote>\n<p>{'fawn': 34701,\n'tsukino': 52006,\n'nunnery': 52007,\n'sonja': 16816,\n'vani': 63951,\n'woods': 1408,\n...\n}</p>\n</blockquote>\n</li>\n<li>\n<p>word_index.items()</p>\n<blockquote>\n<p>dict_items([('fawn', 34701), ('tsukino', 52006),\n('nunnery', 52007), ('sonja', 16816),\n('vani', 63951), ('woods', 1408),\n('spiders', 16115) ,,,</p>\n</blockquote>\n</li>\n</ul>\n<p>pad, start, unknown, unused 값을 나타내기 위해 각 value에 3을 더하고 비어있게 되는 0~3에 각각을 할당한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># 처음 몇 개 인덱스는 사전에 정의되어 있습니다</span>\nword_index <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>k<span class=\"token punctuation\">:</span><span class=\"token punctuation\">(</span>v<span class=\"token operator\">+</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> k<span class=\"token punctuation\">,</span>v <span class=\"token keyword\">in</span> word_index<span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span> \nword_index<span class=\"token punctuation\">[</span><span class=\"token string\">\"&lt;PAD>\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\nword_index<span class=\"token punctuation\">[</span><span class=\"token string\">\"&lt;START>\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\nword_index<span class=\"token punctuation\">[</span><span class=\"token string\">\"&lt;UNK>\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">2</span>  <span class=\"token comment\"># unknown</span>\nword_index<span class=\"token punctuation\">[</span><span class=\"token string\">\"&lt;UNUSED>\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">3</span>\n\nreverse_word_index <span class=\"token operator\">=</span> <span class=\"token builtin\">dict</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span> word_index<span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">decode_review</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> <span class=\"token string\">' '</span><span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>reverse_word_index<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> <span class=\"token string\">'&lt;'</span><span class=\"token operator\">+</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token string\">'>?'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> text<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>실제로 필요한 dictionary는 숫자가 key이고, 단어가 value인 dictionary이기 때문에 reverse<em>word</em>index라는 dictionary를 구성하고 숫자로 이루어진 입력데이터를 단어로 치환해 주며 문장으로 출력하는 <strong>decode_review</strong> 함수를 만든다.</p>\n<h2 id=\"decode-example\" style=\"position:relative;\"><a href=\"#decode-example\" aria-label=\"decode example permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>decode example</h2>\n<ul>\n<li>[1,14,22,16,43,530...] => \"<START> &#x3C;14>? &#x3C;22>? &#x3C;16>? film flick...\"</li>\n<li>1 : <code class=\"language-text\">&lt;START&gt;</code></li>\n<li>14, 22, 16 : unknown</li>\n<li>43 : film</li>\n<li>530 : flick</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">decode_review<span class=\"token punctuation\">(</span>train_data<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&quot;&lt;START&gt; this film was just brilliant casting location scenery story direction everyone&#39;s really suited the part they played and you could just imagine being there robert &lt;UNK&gt; is an amazing actor and now the same being director &lt;UNK&gt; father came from the same scottish island as myself so i loved the fact there was a real connection with this film the witty remarks throughout the film were great it was just brilliant so much that i bought the film as soon as it was released for &lt;UNK&gt; and would recommend it to everyone to watch and the fly fishing was amazing really cried at the end it was so sad and you know what they say if you cry at a film it must have been good and this definitely was also &lt;UNK&gt; to the two little boy&#39;s that played the &lt;UNK&gt; of norman and paul they were just brilliant children are often left out of the &lt;UNK&gt; list i think because the stars that play them all grown up are such a big profile for the whole film but these children are amazing and should be praised for what they have done don&#39;t you think the whole story was so lovely because it was true and was someone&#39;s life after all that was shared with us all&quot;</code></pre></div>\n<p>앞서 추가해주었던 <code class=\"language-text\">START</code>, <code class=\"language-text\">UNK</code> 등이 추가되어 보여지는 것을 확인할 수 있다.</p>\n<h2 id=\"데이터-전치리\" style=\"position:relative;\"><a href=\"#%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%A0%84%EC%B9%98%EB%A6%AC\" aria-label=\"데이터 전치리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>데이터 전치리</h2>\n<p>위에서 언급했던 각 데이터의 길이가 상이한 것을 처리한다. keras에서 제공하는 preprocessing 함수를 이용하여 모든 데이터를 최대길이로 늘려주면서 빈공간에는 위에서 dictionary에 추가적으로 넣어주었던 pad값을 이용한다.</p>\n<p>신경망에 주입하기 전에 텐서로 변환되어야 하는데, 변환하는 방법에는 몇 가지가 있다.</p>\n<ul>\n<li>원-핫 인코딩(one-hot encoding) : 정수 배열을 0과 1로 이루어진 벡터로 변환한다. 예를 들어 배열 [3, 5]을 인덱스 3과 5만 1이고 나머지는 모두 0인 10,000차원 벡터로 변환할 수 있다. 그다음 실수 벡터 데이터를 다룰 수 있는 층-Dense 층-을 신경망의 첫 번째 층으로 사용한다. 이 방법은 num<em>words * num</em>reviews 크기의 행렬이 필요하기 때문에 메모리를 많이 사용하게 된다는 단점이 있다.</li>\n<li>다른 방법으로는, 정수 배열의 길이가 모두 같도록 패딩(padding)을 추가해 max<em>length * num</em>reviews 크기의 정수 텐서를 만드는 방법이다. 이런 형태의 텐서를 다룰 수 있는 임베딩(embedding) 층을 신경망의 첫 번째 층으로 사용할 수 있다.</li>\n</ul>\n<p>여기서는 두 번째 방식을 사용해보자.</p>\n<p>영화 리뷰의 길이가 같아야 하므로 <strong>pad_sequences</strong> 함수를 사용해 길이를 맞추자.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">train_data <span class=\"token operator\">=</span> keras<span class=\"token punctuation\">.</span>preprocessing<span class=\"token punctuation\">.</span>sequence<span class=\"token punctuation\">.</span>pad_sequences<span class=\"token punctuation\">(</span>train_data<span class=\"token punctuation\">,</span>\n                                                        value<span class=\"token operator\">=</span>word_index<span class=\"token punctuation\">[</span><span class=\"token string\">\"&lt;PAD>\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                                                        padding<span class=\"token operator\">=</span><span class=\"token string\">'post'</span><span class=\"token punctuation\">,</span>\n                                                        maxlen<span class=\"token operator\">=</span><span class=\"token number\">256</span><span class=\"token punctuation\">)</span>\n\ntest_data <span class=\"token operator\">=</span> keras<span class=\"token punctuation\">.</span>preprocessing<span class=\"token punctuation\">.</span>sequence<span class=\"token punctuation\">.</span>pad_sequences<span class=\"token punctuation\">(</span>test_data<span class=\"token punctuation\">,</span>\n                                                        value<span class=\"token operator\">=</span>word_index<span class=\"token punctuation\">[</span><span class=\"token string\">\"&lt;PAD>\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                                                        padding<span class=\"token operator\">=</span><span class=\"token string\">'post'</span><span class=\"token punctuation\">,</span>\n                                                        maxlen<span class=\"token operator\">=</span><span class=\"token number\">256</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>이 작업을 통해 변경된 것을 확인해 보면,</p>\n<ol>\n<li>train<em>data, test</em>data 길이가 동일</li>\n<li>배열내 모든 데이터가 256</li>\n<li>데이터 형태는 맨 뒤에 0값, 즉 pad값이 포함되어 있음</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>train_data<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>train_data<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">(256, 256)</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>train_data<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[   1   14   22   16   43  530  973 1622 1385   65  458 4468   66 3941\n    4  173   36  256    5   25  100   43  838  112   50  670    2    9\n   35  480  284    5  150    4  172  112  167    2  336  385   39    4\n  172 4536 1111   17  546   38   13  447    4  192   50   16    6  147\n 2025   19   14   22    4 1920 4613  469    4   22   71   87   12   16\n   43  530   38   76   15   13 1247    4   22   17  515   17   12   16\n  626   18    2    5   62  386   12    8  316    8  106    5    4 2223\n 5244   16  480   66 3785   33    4  130   12   16   38  619    5   25\n  124   51   36  135   48   25 1415   33    6   22   12  215   28   77\n   52    5   14  407   16   82    2    8    4  107  117 5952   15  256\n    4    2    7 3766    5  723   36   71   43  530  476   26  400  317\n   46    7    4    2 1029   13  104   88    4  381   15  297   98   32\n 2071   56   26  141    6  194 7486   18    4  226   22   21  134  476\n   26  480    5  144   30 5535   18   51   36   28  224   92   25  104\n    4  226   65   16   38 1334   88   12   16  283    5   16 4472  113\n  103   32   15   16 5345   19  178   32    0    0    0    0    0    0\n    0    0    0    0    0    0    0    0    0    0    0    0    0    0\n    0    0    0    0    0    0    0    0    0    0    0    0    0    0\n    0    0    0    0]</code></pre></div>\n<h2 id=\"모델-구성하기\" style=\"position:relative;\"><a href=\"#%EB%AA%A8%EB%8D%B8-%EA%B5%AC%EC%84%B1%ED%95%98%EA%B8%B0\" aria-label=\"모델 구성하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>모델 구성하기</h2>\n<p>이제 text classification을 수행할 ML모델을 만들어보자.</p>\n<p>vocab_size는 영화리뷰에 사용되는 단어의 개수이다. 실제로 위에서 단어와 숫자를 매칭하는 dictionary의 사이즈 보다 크지만, 해당 데이터에서는 10000개의 단어 이내로 리뷰가 작성되었다. </p>\n<p>각 레이어에 대한 설명은 다음과 같다.</p>\n<ol>\n<li><strong>embedding</strong> : 숫자로 인코딩 되어있는 각 단어를 사용하며 각 단어 인덱스에 대한 벡터를 찾는다. 이러한 데이터는 추후 모델이 핫습하는데 사용된다.</li>\n<li><strong>GlobalAveragePooling1D</strong> : 각 예시에 대해 sequence 차원을 평균하여 고정된 길이의 벡터를 출력한다.</li>\n<li><strong>Dense</strong> : 첫번째 Dense 레이어를 통해서 고정길이로 출력된 vector값을 통해 16개의 hidden unit을 가진 fully-connected layer를 통과시킨다. 이후 두번째 Dense 레이어는 단일 출력 노드를 가지고 시그모이드 활성화 함수를 사용함으로써 결과에 대해 0~1 사이의 값을 가지도록 한다.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># 입력 크기는 영화 리뷰 데이터셋에 적용된 어휘 사전의 크기입니다(10,000개의 단어)</span>\nvocab_size <span class=\"token operator\">=</span> <span class=\"token number\">10000</span>\n\nmodel <span class=\"token operator\">=</span> keras<span class=\"token punctuation\">.</span>Sequential<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nmodel<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>keras<span class=\"token punctuation\">.</span>layers<span class=\"token punctuation\">.</span>Embedding<span class=\"token punctuation\">(</span>vocab_size<span class=\"token punctuation\">,</span> <span class=\"token number\">16</span><span class=\"token punctuation\">,</span> input_shape<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">None</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nmodel<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>keras<span class=\"token punctuation\">.</span>layers<span class=\"token punctuation\">.</span>GlobalAveragePooling1D<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nmodel<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>keras<span class=\"token punctuation\">.</span>layers<span class=\"token punctuation\">.</span>Dense<span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">,</span> activation<span class=\"token operator\">=</span>tf<span class=\"token punctuation\">.</span>nn<span class=\"token punctuation\">.</span>relu<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nmodel<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>keras<span class=\"token punctuation\">.</span>layers<span class=\"token punctuation\">.</span>Dense<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> activation<span class=\"token operator\">=</span>tf<span class=\"token punctuation\">.</span>nn<span class=\"token punctuation\">.</span>sigmoid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\nmodel<span class=\"token punctuation\">.</span>summary<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">_________________________________________________________________\nLayer (type)                 Output Shape              Param #   \n=================================================================\nembedding_2 (Embedding)      (None, None, 16)          160000    \n_________________________________________________________________\nglobal_average_pooling1d_2 ( (None, 16)                0         \n_________________________________________________________________\ndense_4 (Dense)              (None, 16)                272       \n_________________________________________________________________\ndense_5 (Dense)              (None, 1)                 17        \n=================================================================\nTotal params: 160,289\nTrainable params: 160,289\nNon-trainable params: 0\n_________________________________________________________________</code></pre></div>\n<p>모델 구성에 마지막으로 loss function과 optimizer를 설정한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">model<span class=\"token punctuation\">.</span><span class=\"token builtin\">compile</span><span class=\"token punctuation\">(</span>optimizer<span class=\"token operator\">=</span>tf<span class=\"token punctuation\">.</span>train<span class=\"token punctuation\">.</span>AdamOptimizer<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n              loss<span class=\"token operator\">=</span><span class=\"token string\">'binary_crossentropy'</span><span class=\"token punctuation\">,</span>\n              metrics<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token string\">'acc'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"모델-훈련하기\" style=\"position:relative;\"><a href=\"#%EB%AA%A8%EB%8D%B8-%ED%9B%88%EB%A0%A8%ED%95%98%EA%B8%B0\" aria-label=\"모델 훈련하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>모델 훈련하기</h2>\n<p>모델을 훈련하기에 앞서 10000개의 데이터를 분리하여 validation set을 만들자.\n모델이 새롭게 접하는 데이터에 대한 accuracy와 loss등을 확인하기 위함이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># 검증 세트 만들기</span>\nx_val <span class=\"token operator\">=</span> train_data<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token number\">10000</span><span class=\"token punctuation\">]</span>\npartial_x_train <span class=\"token operator\">=</span> train_data<span class=\"token punctuation\">[</span><span class=\"token number\">10000</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span>\n\ny_val <span class=\"token operator\">=</span> train_labels<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token number\">10000</span><span class=\"token punctuation\">]</span>\npartial_y_train <span class=\"token operator\">=</span> train_labels<span class=\"token punctuation\">[</span><span class=\"token number\">10000</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># 모델 훈련</span>\nhistory <span class=\"token operator\">=</span> model<span class=\"token punctuation\">.</span>fit<span class=\"token punctuation\">(</span>partial_x_train<span class=\"token punctuation\">,</span>\n                    partial_y_train<span class=\"token punctuation\">,</span>\n                    epochs<span class=\"token operator\">=</span><span class=\"token number\">40</span><span class=\"token punctuation\">,</span>\n                    batch_size<span class=\"token operator\">=</span><span class=\"token number\">512</span><span class=\"token punctuation\">,</span>\n                    validation_data<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>x_val<span class=\"token punctuation\">,</span> y_val<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                    verbose<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Train on 15000 samples, validate on 10000 samples\nEpoch 1/40\n15000/15000 [==============================] - 1s 99us/sample - loss: 0.6925 - acc: 0.5343 - val_loss: 0.6918 - val_acc: 0.5347\nEpoch 2/40\n15000/15000 [==============================] - 1s 69us/sample - loss: 0.6899 - acc: 0.6281 - val_loss: 0.6880 - val_acc: 0.6741\nEpoch 3/40\n15000/15000 [==============================] - 1s 70us/sample - loss: 0.6835 - acc: 0.7101 - val_loss: 0.6792 - val_acc: 0.7429\nEpoch 4/40\n15000/15000 [==============================] - 1s 70us/sample - loss: 0.6699 - acc: 0.7408 - val_loss: 0.6623 - val_acc: 0.7469\nEpoch 5/40\n15000/15000 [==============================] - 1s 71us/sample - loss: 0.6463 - acc: 0.7775 - val_loss: 0.6360 - val_acc: 0.7647\nEpoch 6/40\n15000/15000 [==============================] - 1s 71us/sample - loss: 0.6127 - acc: 0.7950 - val_loss: 0.6017 - val_acc: 0.7821\nEpoch 7/40\n15000/15000 [==============================] - 1s 71us/sample - loss: 0.5707 - acc: 0.8089 - val_loss: 0.5601 - val_acc: 0.7975\nEpoch 8/40\n15000/15000 [==============================] - 1s 70us/sample - loss: 0.5240 - acc: 0.8279 - val_loss: 0.5180 - val_acc: 0.8142\nEpoch 9/40\n15000/15000 [==============================] - 1s 72us/sample - loss: 0.4775 - acc: 0.8426 - val_loss: 0.4773 - val_acc: 0.8298\nEpoch 10/40\n15000/15000 [==============================] - 1s 72us/sample - loss: 0.4343 - acc: 0.8581 - val_loss: 0.4416 - val_acc: 0.8392\nEpoch 11/40\n15000/15000 [==============================] - 1s 72us/sample - loss: 0.3966 - acc: 0.8707 - val_loss: 0.4114 - val_acc: 0.8505\nEpoch 12/40\n15000/15000 [==============================] - 1s 72us/sample - loss: 0.3645 - acc: 0.8798 - val_loss: 0.3880 - val_acc: 0.8537\nEpoch 13/40\n15000/15000 [==============================] - 1s 71us/sample - loss: 0.3385 - acc: 0.8867 - val_loss: 0.3670 - val_acc: 0.8615\nEpoch 14/40\n15000/15000 [==============================] - 1s 71us/sample - loss: 0.3154 - acc: 0.8932 - val_loss: 0.3519 - val_acc: 0.8651\nEpoch 15/40\n15000/15000 [==============================] - 1s 71us/sample - loss: 0.2967 - acc: 0.8977 - val_loss: 0.3393 - val_acc: 0.8694\nEpoch 16/40\n15000/15000 [==============================] - 1s 71us/sample - loss: 0.2800 - acc: 0.9027 - val_loss: 0.3290 - val_acc: 0.8711\nEpoch 17/40\n15000/15000 [==============================] - 1s 72us/sample - loss: 0.2651 - acc: 0.9080 - val_loss: 0.3207 - val_acc: 0.8753\nEpoch 18/40\n15000/15000 [==============================] - 1s 72us/sample - loss: 0.2519 - acc: 0.9119 - val_loss: 0.3132 - val_acc: 0.8780\nEpoch 19/40\n15000/15000 [==============================] - 1s 72us/sample - loss: 0.2401 - acc: 0.9159 - val_loss: 0.3070 - val_acc: 0.8791\nEpoch 20/40\n15000/15000 [==============================] - 1s 71us/sample - loss: 0.2295 - acc: 0.9203 - val_loss: 0.3029 - val_acc: 0.8798\nEpoch 21/40\n15000/15000 [==============================] - 1s 72us/sample - loss: 0.2190 - acc: 0.9240 - val_loss: 0.2990 - val_acc: 0.8792\nEpoch 22/40\n15000/15000 [==============================] - 1s 72us/sample - loss: 0.2101 - acc: 0.9261 - val_loss: 0.2951 - val_acc: 0.8828\nEpoch 23/40\n15000/15000 [==============================] - 1s 72us/sample - loss: 0.2011 - acc: 0.9291 - val_loss: 0.2934 - val_acc: 0.8819\nEpoch 24/40\n15000/15000 [==============================] - 1s 72us/sample - loss: 0.1933 - acc: 0.9325 - val_loss: 0.2905 - val_acc: 0.8837\nEpoch 25/40\n15000/15000 [==============================] - 1s 71us/sample - loss: 0.1853 - acc: 0.9369 - val_loss: 0.2883 - val_acc: 0.8846\nEpoch 26/40\n15000/15000 [==============================] - 1s 71us/sample - loss: 0.1783 - acc: 0.9395 - val_loss: 0.2880 - val_acc: 0.8839\nEpoch 27/40\n15000/15000 [==============================] - 1s 71us/sample - loss: 0.1715 - acc: 0.9435 - val_loss: 0.2868 - val_acc: 0.8846\nEpoch 28/40\n15000/15000 [==============================] - 1s 71us/sample - loss: 0.1650 - acc: 0.9460 - val_loss: 0.2861 - val_acc: 0.8845\nEpoch 29/40\n15000/15000 [==============================] - 1s 71us/sample - loss: 0.1596 - acc: 0.9487 - val_loss: 0.2868 - val_acc: 0.8839\nEpoch 30/40\n15000/15000 [==============================] - 1s 71us/sample - loss: 0.1537 - acc: 0.9511 - val_loss: 0.2859 - val_acc: 0.8855\nEpoch 31/40\n15000/15000 [==============================] - 1s 71us/sample - loss: 0.1477 - acc: 0.9538 - val_loss: 0.2861 - val_acc: 0.8857\nEpoch 32/40\n15000/15000 [==============================] - 1s 70us/sample - loss: 0.1423 - acc: 0.9558 - val_loss: 0.2867 - val_acc: 0.8857\nEpoch 33/40\n15000/15000 [==============================] - 1s 70us/sample - loss: 0.1370 - acc: 0.9571 - val_loss: 0.2882 - val_acc: 0.8858\nEpoch 34/40\n15000/15000 [==============================] - 1s 70us/sample - loss: 0.1324 - acc: 0.9605 - val_loss: 0.2892 - val_acc: 0.8868\nEpoch 35/40\n15000/15000 [==============================] - 1s 70us/sample - loss: 0.1282 - acc: 0.9607 - val_loss: 0.2907 - val_acc: 0.8871\nEpoch 36/40\n15000/15000 [==============================] - 1s 70us/sample - loss: 0.1234 - acc: 0.9636 - val_loss: 0.2923 - val_acc: 0.8866\nEpoch 37/40\n15000/15000 [==============================] - 1s 70us/sample - loss: 0.1189 - acc: 0.9657 - val_loss: 0.2941 - val_acc: 0.8860\nEpoch 38/40\n15000/15000 [==============================] - 1s 70us/sample - loss: 0.1148 - acc: 0.9671 - val_loss: 0.2968 - val_acc: 0.8852\nEpoch 39/40\n15000/15000 [==============================] - 1s 70us/sample - loss: 0.1113 - acc: 0.9683 - val_loss: 0.2990 - val_acc: 0.8846\nEpoch 40/40\n15000/15000 [==============================] - 1s 71us/sample - loss: 0.1073 - acc: 0.9699 - val_loss: 0.3009 - val_acc: 0.8841</code></pre></div>\n<p>Epoch 1에서 40까지 진행이 되고 해당 Epoch에서의 acc 및 loss를 확인할 수 있다.</p>\n<p>이제 모델 평가 결과를 확인해 보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">results <span class=\"token operator\">=</span> model<span class=\"token punctuation\">.</span>evaluate<span class=\"token punctuation\">(</span>test_data<span class=\"token punctuation\">,</span> test_labels<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>results<span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">25000/25000 [==============================] - 1s 21us/sample - loss: 0.3204 - acc: 0.8736\n[0.3203906687307358, 0.8736]</code></pre></div>\n<p>실제로 더 진보된 모델이라고 하기 위해서는 약 95% 이상의 정확도를 필요로 한다. 하지만 매우 단순한 방식을 사용했기 때문에 약 87% 정도의 정확도를 달성한 것을 확인 할 수 있다.</p>\n<p>결과를 정확도와 오차의 그래프로 확인해 보자.</p>\n<h2 id=\"정확도와-손실-그래프-그리기\" style=\"position:relative;\"><a href=\"#%EC%A0%95%ED%99%95%EB%8F%84%EC%99%80-%EC%86%90%EC%8B%A4-%EA%B7%B8%EB%9E%98%ED%94%84-%EA%B7%B8%EB%A6%AC%EA%B8%B0\" aria-label=\"정확도와 손실 그래프 그리기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정확도와 손실 그래프 그리기</h2>\n<p><code class=\"language-text\">model.fit()</code>은 History 객체를 반환한다. 여기에는 훈련하는 동안 일어난 모든 정보가 dictionary로 담겨 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">history_dict <span class=\"token operator\">=</span> history<span class=\"token punctuation\">.</span>history\nhistory_dict<span class=\"token punctuation\">.</span>keys<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">dict_keys([&#39;loss&#39;, &#39;acc&#39;, &#39;val_loss&#39;, &#39;val_acc&#39;])</code></pre></div>\n<p>키를 확인해 보면 네개의 항목이 있다. 이는 훈련과 검증 단계에서 모니터링하는 지표들이다. 훈련 손실과 검증 손실을 그래프로 그려 보고, 훈련 정확도와 검증 정확도도 그래프로 그려 비교해 보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> matplotlib<span class=\"token punctuation\">.</span>pyplot <span class=\"token keyword\">as</span> plt\n\nacc <span class=\"token operator\">=</span> history_dict<span class=\"token punctuation\">[</span><span class=\"token string\">'acc'</span><span class=\"token punctuation\">]</span>\nval_acc <span class=\"token operator\">=</span> history_dict<span class=\"token punctuation\">[</span><span class=\"token string\">'val_acc'</span><span class=\"token punctuation\">]</span>\nloss <span class=\"token operator\">=</span> history_dict<span class=\"token punctuation\">[</span><span class=\"token string\">'loss'</span><span class=\"token punctuation\">]</span>\nval_loss <span class=\"token operator\">=</span> history_dict<span class=\"token punctuation\">[</span><span class=\"token string\">'val_loss'</span><span class=\"token punctuation\">]</span>\n\nepochs <span class=\"token operator\">=</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>acc<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 'bo'는 파란색점, 'b'는 파란 실선</span>\nplt<span class=\"token punctuation\">.</span>plot<span class=\"token punctuation\">(</span>epochs<span class=\"token punctuation\">,</span> loss<span class=\"token punctuation\">,</span> <span class=\"token string\">'bo'</span><span class=\"token punctuation\">,</span> label<span class=\"token operator\">=</span><span class=\"token string\">'Training loss'</span><span class=\"token punctuation\">)</span>\nplt<span class=\"token punctuation\">.</span>plot<span class=\"token punctuation\">(</span>epochs<span class=\"token punctuation\">,</span> val_loss<span class=\"token punctuation\">,</span> <span class=\"token string\">'b'</span><span class=\"token punctuation\">,</span> label<span class=\"token operator\">=</span><span class=\"token string\">'Validation loss'</span><span class=\"token punctuation\">)</span>\nplt<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">(</span><span class=\"token string\">'Training and validation loss'</span><span class=\"token punctuation\">)</span>\nplt<span class=\"token punctuation\">.</span>xlabel<span class=\"token punctuation\">(</span><span class=\"token string\">'Epochs'</span><span class=\"token punctuation\">)</span>\nplt<span class=\"token punctuation\">.</span>ylabel<span class=\"token punctuation\">(</span><span class=\"token string\">'Loss'</span><span class=\"token punctuation\">)</span>\nplt<span class=\"token punctuation\">.</span>legend<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\nplt<span class=\"token punctuation\">.</span>show<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 386px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a2dae87ff835d39b3d9bc130108fbc3c/7bc0b/output_39_0.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsSAAALEgHS3X78AAACLklEQVQ4y5VTTW/TQBDduEEcekFInEAQuHDOLT8H/gH9DdCCZE5ce8qtEqmiCAkh6KmR0qIobUIdqXHsFAeifNgN/ggq2bV3mPXabUgrCiM9zc7u7Nu3O7OEXFgGgCiGQZQkXkU8RDxA3EfcQzxCPEbczWZJTlHIKuCmtbVnSi6XE/syZHPzYxYHNzRt8Kpc/tk2jKBGabDvef5n27ab4/G4NRwOvziOcyjGCQ6Pj8fNkxOr3uuZ+6Zp1gaDgYZ5KsETBCHx/eAdjmFvD4BSuNZOTwVc0PUO9Ho9mM1mgAd9IIxRQbgynf4oicQg4PNWi4cAPIwiHnJ+GVEUoY9Cxlg4n89DSulc7J1Op+VzhZ7nbcuzOet0ABwnifiy51cJZlJMUBGESkJYSgnPzgCOjmQURZJM8vBz0iXEhL7vV0g+n78jioJBSRLIRdMEaLcvq7waC4SFQuG2UIhy3yans5RAFEjX5TgM/1aiBcLkyorrutvLhAzTdncBmk2RLCHedjKRsO00loTYahXxdknbyCtL+Tw24UOsp6ZxXq1yruucU7pwUZHM4rkLhahMEGbQp1f+JasWK2VJBZnnAavXgVWr0mMnsCBI1+M92Iv+H23zHv7RsIeh3wfQNIBGA+DgQD7HZOJ/IsVicUVUudFoPMGvplqW9XI0Gr3odruv8SutCy9iy+rjvP0cv5nquoMNxzFUx/m+gV9P3dn5tr619fVNrdZ6Sv7DbiFuXpf0Gx06VEuq6l7pAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"png\"\n        title=\"png\"\n        src=\"/static/a2dae87ff835d39b3d9bc130108fbc3c/7bc0b/output_39_0.png\"\n        srcset=\"/static/a2dae87ff835d39b3d9bc130108fbc3c/5a46d/output_39_0.png 300w,\n/static/a2dae87ff835d39b3d9bc130108fbc3c/7bc0b/output_39_0.png 386w\"\n        sizes=\"(max-width: 386px) 100vw, 386px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">plt<span class=\"token punctuation\">.</span>clf<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>   <span class=\"token comment\"># 그림을 초기화합니다</span>\n\nplt<span class=\"token punctuation\">.</span>plot<span class=\"token punctuation\">(</span>epochs<span class=\"token punctuation\">,</span> acc<span class=\"token punctuation\">,</span> <span class=\"token string\">'bo'</span><span class=\"token punctuation\">,</span> label<span class=\"token operator\">=</span><span class=\"token string\">'Training acc'</span><span class=\"token punctuation\">)</span>\nplt<span class=\"token punctuation\">.</span>plot<span class=\"token punctuation\">(</span>epochs<span class=\"token punctuation\">,</span> val_acc<span class=\"token punctuation\">,</span> <span class=\"token string\">'b'</span><span class=\"token punctuation\">,</span> label<span class=\"token operator\">=</span><span class=\"token string\">'Validation acc'</span><span class=\"token punctuation\">)</span>\nplt<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">(</span><span class=\"token string\">'Training and validation accuracy'</span><span class=\"token punctuation\">)</span>\nplt<span class=\"token punctuation\">.</span>xlabel<span class=\"token punctuation\">(</span><span class=\"token string\">'Epochs'</span><span class=\"token punctuation\">)</span>\nplt<span class=\"token punctuation\">.</span>ylabel<span class=\"token punctuation\">(</span><span class=\"token string\">'Accuracy'</span><span class=\"token punctuation\">)</span>\nplt<span class=\"token punctuation\">.</span>legend<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\nplt<span class=\"token punctuation\">.</span>show<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 386px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/00373d179673d0c997a3c8553237814c/7bc0b/output_40_0.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsSAAALEgHS3X78AAACMklEQVQ4y6WUzU7bQBDHF1qRtKcee6ARoAj1gHgRHqLKEV6jEA7h1NdICpSqqKJCXEAilqgxChDiJMQfITZOcPwhiOPNTnfiBEIrtZE60t+73p357ezs2oT0DfAxsbhIJpeWVsjc3OxUPB5P8LFZrndciUH7nmsmFiNv5+dJYmGBTO/skBjwcK5JZPAOYIdUq/q6pnnnilI7qlQq+WKx+LNarZ01Go0zx7FE37fEdtuU7u5uT6+vm6Ig3J4eH5vS4aEj5HLe0fa2X7i8bGQQ+AKBqmp/5X3QdQ1KJRkURYGHhzYOQacDYBgAkgQgipEuLoD7AagqQLPZdwPX9b8TnslLzptqtVo5HAyCbkBpQHu9kObzHbq52aMHB4wKAqOyzOjNDaOWxajnRXJdRm2bBYwBOI67hRlOYIae52WjdSAMAoC9PQBBALBtXIRBGAJ0uwAYiKL0Sb0eC6MM3S8klUq95ryYbbc/4+D9PQt3dxnU6zwKhoKR9k9jbASYTCbx9IjrRhnm8yzEeqHh6sOMRhVBRvUcOI1ASr0sbq9QiCYRNhr4N3sGXF5eeRXV0Mlh7SiNJn/PaGzg8FB838ua5rDAg42Mb0/Ak5NzvDYx07T7GXJQB0964DSWuG9nANx6vNhXV943+E/jwB+PW97fFz+UStaGrivpRsNYlWV5g392a9gahrGqquq6ZVkf+WeZqdfr6XK5nNF1PY3vmqat1Wq1T5IkpaJfAwAZw95gaf7l9Ashk1VkJynkTwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"png\"\n        title=\"png\"\n        src=\"/static/00373d179673d0c997a3c8553237814c/7bc0b/output_40_0.png\"\n        srcset=\"/static/00373d179673d0c997a3c8553237814c/5a46d/output_40_0.png 300w,\n/static/00373d179673d0c997a3c8553237814c/7bc0b/output_40_0.png 386w\"\n        sizes=\"(max-width: 386px) 100vw, 386px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>점선은 훈련 loss와 accuracy이고 실선은 검증 loss와 accuracy를 나타낸다.</p>\n<p>훈련(점선)에서 loss는 epoch가 진행되면서 감소하고 accuracy는 증가한다. 하지만 검증(실선)에서는 약 20번째 epoch 이후가 최적점인 것 같다. 이는 훈련 데이터에서만 잘 동작하는 과대적합 때문일 것이다. 이 지점 부터는 모델이 과도하게 최적화되어 테스트 데이터에서 일반화되기 어려운 훈련 데이터 특정 표현을 학습하게 된다.</p>\n<p>여기에서는 과대적합을 막기 위해 단순히 20번째 epoch 근처에서 훈련을 멈출 수 있다.</p>"},"primaryTag":{"name":"ML-DL","color":"#4bc822"}},"pageContext":{"postId":"159035b6-bd91-5a14-b4ae-fe4a31f757c7","primaryTag":"ML-DL"}}}